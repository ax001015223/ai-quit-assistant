<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIåŠ©æ‰‹æ˜¾ç¤ºå’Œæ‹–åŠ¨æµ‹è¯•</title>
    <style>
        body {
            font-family: 'PingFang SC', sans-serif;
            padding: 20px;
            background: #F5F1E8;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-left: 4px solid #5A5550;
        }
        h1 { color: #3D3935; }
        h2 { color: #5A5550; margin-top: 20px; }
        .test-btn {
            padding: 10px 20px;
            background: #5A5550;
            color: white;
            border: none;
            cursor: pointer;
            margin: 5px;
        }
        .test-btn:hover {
            background: #3D3935;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
    </style>
</head>
<body>
    <h1>ğŸ”§ AIåŠ©æ‰‹æ˜¾ç¤ºå’Œæ‹–åŠ¨æµ‹è¯•</h1>

    <div class="test-section">
        <h2>æµ‹è¯•é¡¹ç›®</h2>
        <div id="testResults"></div>

        <h3>æ‰‹åŠ¨æµ‹è¯•</h3>
        <button class="test-btn" onclick="testToggle()">1. æµ‹è¯•æ˜¾ç¤º/éšè—</button>
        <button class="test-btn" onclick="testDrag()">2. æµ‹è¯•æ‹–åŠ¨åŠŸèƒ½</button>
        <button class="test-btn" onclick="testPosition()">3. æµ‹è¯•ä½ç½®ä¿å­˜</button>
        <button class="test-btn" onclick="clearPosition()">4. æ¸…é™¤ä¿å­˜çš„ä½ç½®</button>
        <button class="test-btn" onclick="checkCSS()">5. æ£€æŸ¥CSS</button>
    </div>

    <div class="test-section">
        <h2>é—®é¢˜è¯Šæ–­</h2>
        <div id="diagnosis"></div>
    </div>

    <!-- æ¨¡æ‹ŸAIåŠ©æ‰‹ -->
    <button type="button" class="ai-chat-btn" id="aiChatBtn" style="position: fixed; bottom: 30px; right: 30px; width: 65px; height: 65px; border-radius: 50%; background: #5A5550; color: white; border: 2px solid #A89F91; font-size: 1.8rem; cursor: pointer; z-index: 1000;">ğŸ’¬</button>

    <div class="ai-chat-window" id="aiChatWindow" style="position: fixed; bottom: 110px; right: 30px; width: 360px; height: 520px; background: #E8E3D8; border: 2px solid #C4C0B8; display: none; flex-direction: column; z-index: 999;">
        <div class="chat-header" style="background: #5A5550; color: #F5F1E8; padding: 18px 20px; display: flex; justify-content: space-between; align-items: center; cursor: move; user-select: none;">
            <h3 style="margin: 0; font-weight: 400; letter-spacing: 2px; font-size: 1rem;">ğŸ¤– AIåŠ©æ‰‹</h3>
            <div class="chat-header-actions" style="display: flex; gap: 8px;">
                <button type="button" class="header-icon-btn" style="background: transparent; border: none; color: #F5F1E8; font-size: 1.2rem; cursor: pointer;">ğŸ—‘ï¸</button>
                <button type="button" class="close-btn" id="closeChatBtn" style="background: transparent; border: none; color: #F5F1E8; font-size: 1.8rem; cursor: pointer;">Ã—</button>
            </div>
        </div>
        <div class="chat-messages" style="flex: 1; padding: 18px; background: #F5F1E8; overflow-y: auto;">
            <p>è¿™æ˜¯æµ‹è¯•çª—å£</p>
            <p>å°è¯•æ‹–åŠ¨æ ‡é¢˜æ ç§»åŠ¨çª—å£</p>
            <p>ç‚¹å‡»å…³é—­æŒ‰é’®éšè—çª—å£</p>
        </div>
    </div>

    <script>
        let testResults = document.getElementById('testResults');
        let diagnosis = document.getElementById('diagnosis');

        // è‡ªåŠ¨æµ‹è¯•
        window.onload = function() {
            runAutoTests();
        };

        function addResult(message, type) {
            let div = document.createElement('div');
            div.className = 'status ' + type;
            div.textContent = message;
            testResults.appendChild(div);
        }

        function runAutoTests() {
            addResult('å¼€å§‹è‡ªåŠ¨æµ‹è¯•...', 'info');

            // æµ‹è¯•1: å…ƒç´ å­˜åœ¨
            const chatBtn = document.getElementById('aiChatBtn');
            const chatWindow = document.getElementById('aiChatWindow');
            if (chatBtn && chatWindow) {
                addResult('âœ“ AIåŠ©æ‰‹å…ƒç´ å­˜åœ¨', 'success');
            } else {
                addResult('âœ— AIåŠ©æ‰‹å…ƒç´ ç¼ºå¤±', 'error');
            }

            // æµ‹è¯•2: åˆå§‹çŠ¶æ€
            if (chatWindow.style.display === 'none' || !chatWindow.classList.contains('active')) {
                addResult('âœ“ åˆå§‹çŠ¶æ€æ­£ç¡®(éšè—)', 'success');
            } else {
                addResult('âœ— åˆå§‹çŠ¶æ€é”™è¯¯(åº”è¯¥éšè—)', 'error');
            }

            // æµ‹è¯•3: äº‹ä»¶ç»‘å®š
            setupEvents();
            addResult('âœ“ äº‹ä»¶ç›‘å¬å™¨å·²ç»‘å®š', 'success');

            addResult('è‡ªåŠ¨æµ‹è¯•å®Œæˆ,è¯·æ‰‹åŠ¨æµ‹è¯•æ‹–åŠ¨åŠŸèƒ½', 'info');
        }

        function setupEvents() {
            const chatBtn = document.getElementById('aiChatBtn');
            const chatWindow = document.getElementById('aiChatWindow');
            const closeBtn = document.getElementById('closeChatBtn');

            chatBtn.addEventListener('click', function(e) {
                e.preventDefault();
                chatWindow.style.display = chatWindow.style.display === 'none' ? 'flex' : 'none';
                chatWindow.classList.toggle('active');
            });

            closeBtn.addEventListener('click', function(e) {
                e.preventDefault();
                chatWindow.style.display = 'none';
                chatWindow.classList.remove('active');
            });

            // ç®€å•æ‹–åŠ¨
            const chatHeader = chatWindow.querySelector('.chat-header');
            let isDragging = false;
            let currentX, currentY, initialX, initialY, xOffset = 0, yOffset = 0;

            chatHeader.addEventListener('mousedown', function(e) {
                if (e.target.closest('.close-btn') || e.target.closest('.header-icon-btn')) {
                    return;
                }
                initialX = e.clientX - xOffset;
                initialY = e.clientY - yOffset;
                isDragging = true;
            });

            document.addEventListener('mousemove', function(e) {
                if (isDragging) {
                    e.preventDefault();
                    currentX = e.clientX - initialX;
                    currentY = e.clientY - initialY;
                    xOffset = currentX;
                    yOffset = currentY;
                    chatWindow.style.transform = `translate(${xOffset}px, ${yOffset}px)`;
                }
            });

            document.addEventListener('mouseup', function(e) {
                isDragging = false;
            });
        }

        function testToggle() {
            const chatWindow = document.getElementById('aiChatWindow');
            chatWindow.style.display = chatWindow.style.display === 'none' ? 'flex' : 'none';
            addResult('åˆ‡æ¢æ˜¾ç¤ºçŠ¶æ€: ' + (chatWindow.style.display === 'flex' ? 'æ˜¾ç¤º' : 'éšè—'), 'info');
        }

        function testDrag() {
            addResult('è¯·æ‰‹åŠ¨æ‹–åŠ¨AIåŠ©æ‰‹çª—å£çš„æ ‡é¢˜æ æµ‹è¯•', 'info');
        }

        function testPosition() {
            const chatWindow = document.getElementById('aiChatWindow');
            const transform = chatWindow.style.transform;
            addResult('å½“å‰ä½ç½®: ' + (transform || 'é»˜è®¤ä½ç½®'), 'info');
        }

        function clearPosition() {
            localStorage.removeItem('chatWindowPosition');
            const chatWindow = document.getElementById('aiChatWindow');
            chatWindow.style.transform = '';
            addResult('å·²æ¸…é™¤ä¿å­˜çš„ä½ç½®', 'success');
        }

        function checkCSS() {
            const chatWindow = document.getElementById('aiChatWindow');
            const computed = window.getComputedStyle(chatWindow);
            diagnosis.innerHTML = `
                <div class="status info">
                    <strong>CSS è¯Šæ–­:</strong><br>
                    display: ${computed.display}<br>
                    position: ${computed.position}<br>
                    transform: ${computed.transform}<br>
                    z-index: ${computed.zIndex}<br>
                    bottom: ${computed.bottom}<br>
                    right: ${computed.right}
                </div>
            `;
        }
    </script>
</body>
</html>
